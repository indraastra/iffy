title: "Murder Investigation"
author: "Converted from Ink Example"
version: "1.0"

metadata:
  setting:
    time: "Early 20th century"
    place: "Crime scene - victim's bedroom"
  tone:
    overall: "Noir detective procedural"
    narrative_voice: "First person, observational, methodical"
  themes:
    - "Methodical investigation"
    - "Deduction through evidence"
    - "The truth beneath appearances"
  ui:
    colors:
      primary: "#2B2B2B"
      background: "#F5F5DC"
      text: "#333333"

characters:
  - id: "joe"
    name: "Joe"
    traits:
      - "police_contact"
      - "practical"
      - "experienced"
    voice: "Direct, professional. Uses police jargon sparingly."
    description: |
      My police contact. He's waiting in the hall for my findings. 
      Professional but appreciative of good detective work.

  - id: "player"
    name: "The Investigator"
    traits:
      - "methodical"
      - "observant"
      - "experienced"
    voice: "Internal monologue, analytical"
    description: "You are a private investigator called in to examine the crime scene."

locations:
  - id: "bedroom"
    name: "Bedroom"
    connections:
      - "hallway"
    description: |
      The bedroom. This is where it happened. Now to look for clues.
    objects:
      - name: "Bed"
        description: "Low to the ground, currently neatly made"
      - name: "Desk"
        description: "A lamp in one corner, empty in-tray in the other"
      - name: "Window"
        description: "Overlooks a dismal brook beside the house"
      - name: "Desk lamp"
        description: "Currently off, on the desk"
        id: "desk_lamp"
      - name: "Wooden cane"
        description: "Leaning against the desk, heavy but not a bludgeon"
        id: "wooden_cane"

  - id: "hallway"
    name: "Hallway"
    connections:
      - "bedroom"
    description: "The hallway outside the bedroom where Joe waits."

items:
  - id: "wooden_cane"
    name: "Wooden Cane"
    description: "Heavy and unmarked. Could be used in self-defense but not as a bludgeon."
    location: "bedroom"

  - id: "knife"
    name: "Bloodied Knife"
    description: "The murder weapon. Has partial fingerprints on the hilt."
    location: "bedroom"
    hidden: true

knowledge:
  - id: "bed_neatly_made"
    description: "The bed is pristinely made"
    requires: []

  - id: "crumpled_duvet"
    description: "The duvet underneath the cover is crumpled"
    requires:
      - "examined:bedcover"

  - id: "hastily_remade"
    description: "The bed was remade in a hurry after the incident"
    requires:
      - "knows:crumpled_duvet"

  - id: "bloodstain_on_sheet"
    description: "There's blood on the sheet under the duvet"
    requires:
      - "examined:duvet"

  - id: "body_was_on_bed"
    description: "The body was on the bed at some point"
    requires:
      - "knows:bloodstain_on_sheet"

  - id: "murdered_in_bed"
    description: "The victim was killed while in bed"
    requires:
      - "knows:body_was_on_bed"
      - "examined:bloodstain_with_light"

  - id: "murdered_while_asleep"
    description: "The victim was killed while sleeping"
    requires:
      - "knows:murdered_in_bed"
      - "talked_to:joe"

  - id: "prints_on_knife"
    description: "There are partial fingerprints on the knife hilt"
    requires:
      - "has_item:knife"

  - id: "prints_on_window"
    description: "There are fingerprints on the window glass"
    requires:
      - "examined:window_steam"

  - id: "prints_match"
    description: "The prints on the knife match those on the window"
    requires:
      - "knows:prints_on_knife"
      - "knows:prints_on_window"

flows:
  - id: "start_investigation"
    type: "narrative"
    name: "Initial Investigation"
    requirements: []
    sets:
      - "investigating"
    content: |
      You stand in the bedroom where the murder took place. The room seems 
      undisturbed at first glance - bed neatly made, desk tidy, window closed. 
      But you know better than to trust first impressions.
      
      Your trained eye takes in the details: the position of the furniture, 
      the state of various objects, potential hiding places. Time to get to work.
    next:
      - type: "narrative"
        trigger: "examine bed"
        flow_id: "bed_examination"
      - type: "narrative"
        trigger: "examine desk"
        flow_id: "desk_examination"
      - type: "narrative"
        trigger: "examine window"
        flow_id: "window_examination"
      - type: "narrative"
        trigger: "look under bed"
        flow_id: "under_bed_search"
    player_goal: "Examine the room systematically"

  - id: "bed_examination"
    type: "narrative"
    name: "The Bed's Secret"
    requirements:
      - "investigating"
    sets:
      - "knows:bed_neatly_made"
    content: |
      The bed was low to the ground, but not so low something might not roll 
      underneath. It was still neatly made.
    next:
      - type: "narrative"
        trigger: "lift bedcover"
        flow_id: "bedcover_lifted"
      - type: "narrative"
        trigger: "look under bed"
        flow_id: "under_bed_search"
    hint: "Try lifting the bedcover or looking underneath"

  - id: "bedcover_lifted"
    type: "narrative"
    name: "Under the Covers"
    requirements:
      - "knows:bed_neatly_made"
    sets:
      - "knows:crumpled_duvet"
      - "bed_state:covers_shifted"
    content: |
      I lifted back the bedcover. The duvet underneath was crumpled. Not the 
      work of the maid, who was conscientious to a point.
    next:
      - type: "narrative"
        trigger: "pull back duvet"
        flow_id: "blood_found"
    player_goal: "Investigate further - why is the duvet crumpled?"

  - id: "blood_found"
    type: "narrative"
    name: "Blood Discovery"
    requirements:
      - "knows:crumpled_duvet"
    sets:
      - "knows:bloodstain_on_sheet"
      - "bed_state:bloodstain_visible"
    content: |
      I pulled back the duvet. Beneath it was a sheet, sticky with blood. Either 
      the body had been moved here before being dragged to the floor - or this 
      is where the murder had taken place.
    next:
      - type: "narrative"
        trigger: "examine bloodstain with light"
        flow_id: "examine_bloodstain"
      - type: "dialogue"
        trigger: "talk to Joe about findings"
        flow_id: "report_to_joe"

  - id: "under_bed_search"
    type: "narrative"
    name: "What's Hidden"
    requirements:
      - "investigating"
    sets:
      - "has_item:knife"
    content: |
      Crouching down to look under the bed, your flashlight catches something 
      metallic. A bloodied knife, hastily shoved out of sight. The murder weapon.
    next:
      - type: "narrative"
        trigger: "examine knife"
        flow_id: "knife_examination"

  - id: "knife_examination"
    type: "narrative"
    name: "The Murder Weapon"
    requirements:
      - "has_item:knife"
    sets:
      - "knows:prints_on_knife"
    content: |
      The knife is clearly the murder weapon - blood still stains the blade. 
      More importantly, there are partial fingerprints on the hilt. Clear enough 
      for identification if you can find a match.
    next:
      - type: "dialogue"
        trigger: "discuss with Joe"
        flow_id: "report_to_joe"

  - id: "report_to_joe"
    type: "dialogue"
    name: "Reporting Findings"
    participants:
      - "joe"
      - "player"
    location: "hallway"
    requirements:
      - "knows:bloodstain_on_sheet"
    exchanges:
      - speaker: "player"
        text: "Joe, I've found something significant."
      - speaker: "joe"
        text: "What have you got for me?"
      - speaker: "player"
        choices:
          - text: "The victim was killed in bed, then the scene was staged."
            next: "joe_murder_in_bed"
            sets: ["knows:murdered_in_bed"]
          - text: "I found the murder weapon hidden under the bed."
            next: "joe_weapon_found"
            sets: ["weapon_reported"]

  - id: "desk_examination"
    type: "narrative"
    name: "Examining the Desk"
    requirements:
      - "investigating"
    content: |
      The desk is tidy but lived-in. A lamp sits in one corner, an empty in-tray 
      in the other. Everything appears normal, but something catches your eye.
    next:
      - type: "narrative"
        trigger: "examine lamp"
        flow_id: "lamp_examination"

  - id: "window_examination" 
    type: "narrative"
    name: "The Window"
    requirements:
      - "investigating"
    content: |
      The window overlooks a dismal brook beside the house. The glass appears 
      clean but when you breathe on it, something becomes visible.
    sets:
      - "knows:prints_on_window"
    next:
      - type: "narrative"
        trigger: "examine fingerprints"
        flow_id: "fingerprint_analysis"

  - id: "examine_bloodstain"
    type: "narrative" 
    name: "Bloodstain Analysis"
    requirements:
      - "knows:bloodstain_on_sheet"
    sets:
      - "knows:murdered_in_bed"
    content: |
      Using your flashlight, you examine the bloodstain more carefully. The pattern 
      and concentration tell a clear story - this is where the victim was killed, 
      not just where the body was placed.

  - id: "lamp_examination"
    type: "narrative"
    name: "The Desk Lamp"
    requirements:
      - "investigating"
    content: |
      The desk lamp is off, but when you turn it on, it provides excellent 
      illumination for detailed examination work.

  - id: "fingerprint_analysis"
    type: "narrative"
    name: "Fingerprint Evidence"
    requirements:
      - "knows:prints_on_window"
      - "knows:prints_on_knife"
    sets:
      - "knows:prints_match"
    content: |
      Comparing the prints on the window with those on the knife, you make a 
      startling discovery - they match! The killer touched both items.

  - id: "joe_murder_in_bed"
    type: "dialogue"
    name: "Murder in Bed Theory"
    participants:
      - "joe"
      - "player"
    requirements:
      - "knows:murdered_in_bed"
    exchanges:
      - speaker: "joe"
        text: "That changes things. So the killer tried to cover their tracks by moving the body?"
      - speaker: "player"
        text: "Exactly. The bed was hastily remade, but they missed the blood on the sheets underneath."
      - speaker: "joe"
        text: "Good work. That suggests someone with access to the house. What else?"

  - id: "joe_weapon_found"
    type: "dialogue"
    name: "Weapon Evidence"
    participants:
      - "joe"
      - "player"
    requirements:
      - "weapon_reported"
    exchanges:
      - speaker: "joe"
        text: "A knife under the bed? That's significant evidence. Any prints?"
      - speaker: "player"
        text: "Partial fingerprints on the hilt. Clear enough for identification."
      - speaker: "joe"
        text: "Excellent work. This gives us solid physical evidence."

start:
  text: |
    You've been called to investigate a murder. The victim was found on the floor 
    of their bedroom, but something doesn't feel right about the scene.
  location: "bedroom"
  first_flow: "start_investigation"

endings:
  - id: "case_solved"
    name: "Case Closed"
    requires:
      - "knows:prints_match"
      - "weapon_reported"
    content: |
      With the fingerprint evidence matching between the knife and window, 
      and your reconstruction of the crime scene, you've built a solid case. 
      The killer's attempt to stage the scene has been exposed.