title: "Coffee Confessional"
author: "Iffy Engine Team"
version: "2.0"
blurb: "Help a friend open up about what's been troubling them."

metadata:
  setting:
    time: "Friday evening, 6:30 PM"
    place: "Small corner café, almost closing time"
  tone:
    overall: "Intimate, contemplative, with underlying romantic tension"
    narrative_voice: "Gentle and observant, noticing small details and emotions"
  themes:
    - "Unspoken feelings and missed connections"
    - "The courage to be vulnerable"
    - "Friendship at a crossroads"
    - "The weight of secrets"

characters:
  - id: "player"
    name: "You"
    traits: ["caring", "observant", "patient", "hopeful"]
    voice: "Warm and genuine, someone who listens carefully"
    description: "A close friend who has noticed something has been weighing on Alex lately"

  - id: "alex"
    name: "Alex"
    traits: ["conflicted", "guarded", "thoughtful", "secretly vulnerable"]
    voice: "Careful with words, but warmth shows through despite trying to keep distance"
    description: "Your friend who has been acting differently lately - more distant, distracted, as if carrying a secret"

locations:
  - id: "corner_cafe"
    name: "The Grind Corner Café"
    connections: []
    description: |
      A cozy café with mismatched furniture and the lingering aroma of coffee beans. 
      Most customers have left for the evening. Soft jazz plays from hidden speakers, 
      and warm light filters through rain-spotted windows. The barista is quietly 
      cleaning up behind the counter.
    objects:
      - name: "small round table"
        description: "A wobbly table by the window with two steaming coffee cups"
      - name: "rain-spotted window"
        description: "Shows the quiet street outside, with streetlights beginning to glow"
      - name: "coffee cups"
        description: "Two ceramic mugs - one barely touched, the other empty"

items:
  - id: "unfinished_coffee"
    name: "Alex's Coffee"
    display_name: "coffee"
    description: "A nearly full cup that's gone cold while Alex stares out the window"
    location: "corner_cafe"
    aliases: ["coffee", "alex's cup"]

  - id: "phone"
    name: "Alex's Phone"
    display_name: "phone"
    description: "Face down on the table, but you noticed it buzzing with unread messages earlier"
    location: "corner_cafe"
    aliases: ["phone", "cell phone", "mobile"]

# Format v2: Success conditions define story outcomes
success_conditions:
  - id: "full_confession"
    description: "Alex opens up completely about their feelings and what's been troubling them"
    requires: ["alex_vulnerable", "admitted_feelings", "secret_revealed", "trust_established", "conversation_ending"]

  - id: "partial_opening"
    description: "Alex admits something is wrong but doesn't reveal the full truth, and the conversation naturally ends"
    requires: ["alex_conflicted", "acknowledged_distance", "partial_trust", "conversation_ending"]

  - id: "walls_stay_up"
    description: "Alex remains guarded and deflects attempts to connect"
    requires: ["alex_defensive", "topic_avoided", "distance_maintained", "conversation_ending"]

# First flow automatically becomes the starting point
flows:
  - id: "opening"
    name: "A Quiet Moment"
    type: "narrative"
    location: "corner_cafe"
    content: |
      You're sitting across from Alex in a quiet corner café. They've been acting distant lately, 
      and tonight feels different - like there's something they want to say but can't.
      
      The barista approaches, wiping her hands on her apron. "I noticed your coffee's 
      gone cold. Should I warm it up for you?"
      
      Alex doesn't respond, still stirring absently while staring out the rain-spotted window. 
      The barista glances at you with a gentle, questioning look.

# Format v2: LLM story guidelines for intelligent behavior
llm_guidelines: |
  STORY TONE: This is an intimate, realistic conversation between close friends where one is hiding something important. Focus on subtle emotional cues, meaningful silences, and the gradual building of trust.
  
  PRONOUN USAGE: 
  - Start by using "they/them" pronouns for Alex or avoiding pronouns by using Alex's name
  - If the player uses specific pronouns (he/him, she/her, they/them) when referring to Alex, adopt those same pronouns consistently throughout the rest of the story
  - This should feel natural - once established, maintain consistency
  - Example: If player says "She's fine, thanks" then use she/her for Alex going forward
  
  CHARACTER DYNAMICS:
  - Player: Caring friend who has noticed Alex's distance. Wants to help but must be patient and gentle.
  - Alex: Struggling with unspoken feelings (romantic feelings for the player). Torn between wanting to confess and fear of ruining the friendship.
  
  ALEX'S EMOTIONAL ARC:
  Alex starts guarded and conflicted, slowly opening up based on the player's approach:
  - Defensive → Conflicted → Vulnerable → Open
  - Patient, empathetic responses help Alex feel safe to share
  - Pushy or judgmental responses make Alex shut down
  
  THE SECRET:
  Alex has developed romantic feelings for the player but is terrified of ruining their friendship. They've been pulling away to protect themselves and the relationship, but it's making everything worse. This is why they've been distant lately.
  
  CONVERSATION GOALS:
  - Create realistic dialogue that feels natural, not scripted
  - Show Alex's internal struggle through body language and hesitation
  - Let the player discover the truth through careful conversation
  - Build emotional intimacy gradually through the scene
  
  FLAG PROGRESSION:
  Set these flags as the conversation develops:
  - "acknowledged_distance" → when Alex admits they've been acting differently
  - "alex_conflicted" → when internal struggle becomes apparent
  - "partial_trust" → when Alex starts to open up a little
  - "topic_avoided" → if Alex deflects or changes subject
  - "alex_defensive" → if Alex shuts down or gets defensive
  - "alex_vulnerable" → when Alex's emotional walls start coming down
  - "trust_established" → when Alex feels safe with the player
  - "admitted_feelings" → when Alex confesses their romantic feelings
  - "secret_revealed" → when the full truth about their behavior comes out
  - "distance_maintained" → if Alex keeps emotional walls up
  - "conversation_ending" → ONLY when Alex or the player makes moves to leave (getting up, checking time, saying goodbye, etc.)
  
  CONVERSATION FLOW DESIGN:
  - The story should progress naturally: partial_trust can lead to alex_vulnerable if the player continues being supportive
  - Only set "conversation_ending" if someone actually indicates they want to leave
  - If Alex reaches partial_trust but the player keeps engaging supportively, Alex can progress to being more vulnerable
  - The "partial_opening" ending should only trigger if there's a natural conclusion (like the ending text suggests a walk)
  
  ENVIRONMENTAL DETAILS:
  Use the café setting to enhance intimacy - the quiet atmosphere, the rain outside, the dim lighting, the nearly empty space. These details can reflect the emotional tone of the conversation.
  
  REALISTIC DIALOGUE:
  - Include natural hesitations, incomplete sentences, and meaningful silences
  - Show emotions through actions: stirring coffee, looking away, fidgeting
  - Let Alex's feelings emerge gradually, not all at once
  - Make the player work for trust through genuine care and patience
  
  IMPORTANT: Do not write ending text when success conditions are met. Let the engine handle the conclusion while you focus on authentic character interactions and emotional development.