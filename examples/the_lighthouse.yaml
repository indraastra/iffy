title: "The Lighthouse Keeper's Last Night"
author: "Iffy Engine Team"
version: "1.0"

metadata:
  setting:
    time: "A storm-lashed October evening, 1924"
    place: "Blackrock Light Station, isolated on the Maine coast"
  tone:
    overall: "Gothic atmospheric horror with poetic melancholy - like Poe meets Hemingway"
    narrative_voice: "Third person limited, lyrical and haunting, with growing psychological tension"
  themes:
    - "Isolation and madness"
    - "The weight of duty vs. personal desire"
    - "Nature's indifference to human suffering"
    - "Memory and regret"
  ui:
    colors:
      primary: "#8b4513"
      background: "#1a1a2e"
      text: "#eee2dc"

characters:
  - id: "player"
    name: "Thomas Wickham"
    traits: ["dutiful", "haunted", "introspective", "slowly_unraveling"]
    voice: "Internal monologue, increasingly fragmented and poetic"
    description: "Lighthouse keeper of thirty years, facing his final night before retirement"

  - id: "memory_wife"
    name: "Eleanor (Memory)"
    traits: ["loving", "worried", "fading", "accusatory"]
    voice: "Whispered recollections, growing more distorted"
    description: "Thomas's deceased wife, appearing in increasingly vivid memories"

  - id: "memory_son"
    name: "James (Memory)"
    traits: ["adventurous", "young", "lost", "pleading"]
    voice: "Child-like, echoing, desperate"
    description: "Thomas's son who was lost at sea five years ago"

locations:
  - id: "lighthouse_base"
    name: "The Lighthouse Base"
    connections: ["lighthouse_stairs", "keepers_quarters"]
    description: |
      The massive stone foundation groans against the Atlantic's fury. Salt-stained
      windows rattle in their iron frames. The familiar weight of duty presses down
      like the storm itself - thirty years of nights just like this one, but tonight
      feels different. Tonight feels final.
    objects:
      - name: "storm doors"
        description: "Heavy oak barriers that have held against a thousand storms"
      - name: "supply crates"
        description: "Tomorrow's provisions - someone else's responsibility now"
      - name: "logbook stand"
        description: "Where decades of weather and worry have been recorded"

  - id: "lighthouse_stairs"
    name: "The Spiral Stairs"
    connections: ["lighthouse_base", "lamp_room"]
    description: |
      One hundred and forty-seven steps wind upward into darkness. Your legs know
      each worn groove, each place where the iron rail has been polished smooth
      by countless urgent climbs. The storm's howl echoes differently here - like
      voices calling from the past.
    objects:
      - name: "iron railings"
        description: "Worn smooth by thirty years of desperate grips"
      - name: "small windows"
        description: "Narrow slits that frame the storm's violence"
      - name: "emergency supplies"
        description: "Oil, matches, spare wicks - the tools of your trade"

  - id: "lamp_room"
    name: "The Lamp Room"
    connections: ["lighthouse_stairs"]
    description: |
      The great lens dominates this glass-walled sanctuary above the storm. Its
      Fresnel prisms catch and multiply every flicker of flame into a beacon that
      has guided thousands safely home. But not everyone. Never everyone. The light
      cannot save what is already lost.
    objects:
      - name: "fresnel lens"
        description: "The lighthouse's great eye, magnifying hope into the darkness"
      - name: "oil reservoir"
        description: "The lamp's lifeblood, measured in hours and lives"
      - name: "weather glass"
        description: "Predicting tomorrow's sorrows from tonight's pressure"

  - id: "keepers_quarters"
    name: "The Keeper's Quarters"
    connections: ["lighthouse_base"]
    description: |
      Twenty feet of stone separate this room from the ocean's rage, but the
      solitude seeps through anyway. Eleanor's needlework still hangs on the wall.
      James's toy boat sits on the mantel. Some ghosts refuse to be packed away
      with the rest of your life.
    objects:
      - name: "writing desk"
        description: "Where weather reports become poetry, and duty becomes confession"
      - name: "family photographs"
        description: "Faces that grow clearer as the light grows dimmer"
      - name: "fireplace"
        description: "Warmth that cannot reach the coldest parts of memory"

items:
  - id: "resignation_letter"
    name: "Letter of Resignation"
    description: "Thirty years of service ending with a signature and a few polite words"
    location: "keepers_quarters"
    aliases: ["letter", "resignation", "papers"]

  - id: "storm_journal"
    name: "Storm Journal"
    description: "Your private record of this night - perhaps your most important entry"
    discoverable_in: "keepers_quarters"
    discovery_objects: ["writing desk", "drawer", "papers"]
    aliases: ["journal", "diary", "notebook"]

  - id: "lighthouse_key"
    name: "Lighthouse Key"
    description: "Heavy brass, worn smooth - the weight of responsibility made tangible"
    discoverable_in: "lighthouse_base"
    discovery_objects: ["logbook stand", "official papers", "duty roster"]
    aliases: ["key", "brass key", "master key"]

  - id: "eleanors_locket"
    name: "Eleanor's Locket"
    description: "Silver tarnished with grief, containing a miniature of happier days"
    discoverable_in: "keepers_quarters"
    discovery_objects: ["family photographs", "mantel", "personal effects"]
    aliases: ["locket", "silver locket", "keepsake"]

knowledge:
  - id: "storm_severity"
    description: "This storm is unlike any you've seen - the barometer reads dangerously low"
    requires: []

  - id: "replacement_delayed"
    description: "Your replacement cannot reach the lighthouse until the storm passes"
    requires: ["examined:resignation_letter"]

  - id: "ships_in_danger"
    description: "Several vessels are fighting the storm near the treacherous rocks"
    requires: ["location:lamp_room"]

  - id: "personal_guilt"
    description: "The weight of those you couldn't save haunts every decision"
    requires: ["has_item:eleanors_locket"]

  - id: "duty_vs_freedom"
    description: "The terrible choice between responsibility and release"
    requires: ["has_item:lighthouse_key", "knows:ships_in_danger"]

flows:
  - id: "final_watch"
    type: "narrative"
    name: "The Weight of Duty"
    description: |
      The storm builds like a symphony of destruction outside. This is your last
      night as keeper of Blackrock Light, but the storm cares nothing for schedules.
      Ships are out there, fighting for their lives, and the light must not fail.
      
      But after thirty years of faithful service, after losing everything that
      mattered to the sea's hunger, what do you owe this place? What does it owe you?
    
    llm_guidelines: |
      - Maintain gothic atmospheric tone throughout
      - Use poetic, melancholy language with maritime imagery
      - Show Thomas's psychological state through environmental descriptions
      - Build tension between duty and personal desire
      - Incorporate memories naturally into present action
      - Use weather and lighthouse imagery symbolically
      - Show the isolation's effect on perception
      - Let the player's choices reflect internal conflict
    
    completion_transitions:
      - condition: "knows:duty_vs_freedom"
        to_flow: "the_choice"
      - condition: "has_item:storm_journal"
        to_flow: "writing_confession"

  - id: "writing_confession"
    type: "narrative"
    name: "Words on Paper"
    requirements: ["has_item:storm_journal"]
    content: |
      The pen feels foreign in your salt-stained fingers. How do you summarize
      thirty years of service, of loss, of nights like this? The journal opens
      to blank pages, white as the foam that took your son.
      
      "October 15th, 1924 - Final entry," you write, then stop. The storm rattles
      the windows like Eleanor used to knock when she brought you coffee during
      the long watches. She understood the sea's moods better than most sailors.
      
      Perhaps she understands this choice too.
    
    completion_transitions:
      - condition: "knows:duty_vs_freedom"
        to_flow: "the_choice"

  - id: "the_choice"
    type: "dialogue"
    name: "Voices in the Storm"
    participants: ["player", "memory_wife", "memory_son"]
    requirements: ["knows:duty_vs_freedom"]
    player_goal: "Decide between duty and freedom on this final night"
    
    exchanges:
      - speaker: "memory_wife"
        text: |
          "Thomas..." Eleanor's voice drifts through the storm-song. "You've given
          enough. Thirty years of nights, of worry, of watching the horizon for
          ships that might never come home. When do you get to rest?"
        emotion: "loving_concern"
        choices:
          - text: "But there are ships out there tonight, Eleanor. I can't abandon them."
            next: "duty_response"
          - text: "I'm so tired, love. So very tired of watching and waiting."
            next: "weariness_response"
          - text: "What about James? What about our boy?"
            next: "grief_response"
      
      - speaker: "memory_son"
        text: |
          "Papa!" James's voice echoes from the lamp room above. "The light, Papa!
          I can see the light from here! It's so bright, so warm... Come see, Papa!
          Come up to the light!"
        emotion: "childlike_wonder"
        choices:
          - text: "I have to keep the light burning for others, James."
            next: "lighthouse_duty"
            sets: ["chose_duty"]
          - text: "I'm coming, son. I'm finally coming."
            next: "join_family"
            sets: ["chose_freedom"]
    
    completion_transitions:
      - condition: "flag:chose_duty"
        to_flow: "keeper_eternal"
      - condition: "flag:chose_freedom"
        to_flow: "lighthouse_abandoned"

  - id: "keeper_eternal"
    type: "narrative"
    name: "The Eternal Watch"
    requirements: ["flag:chose_duty"]
    ends_game: true
    content: |
      You climb the one hundred and forty-seven steps one last time, but somehow
      you know it won't be the last. The great lens blazes with impossible
      brilliance, cutting through storm and darkness to guide the lost ships home.
      
      Your replacement will find the lighthouse in perfect order - lamp trimmed,
      lens polished, logbook up to date. They'll find your resignation letter
      torn neatly in half, and they'll understand. Some duties transcend a single
      lifetime.
      
      In the morning, when the storm breaks, the ships will reach harbor safely.
      Families will embrace on rain-washed docks. Children will run to fathers
      they thought they'd lost.
      
      And Thomas Wickham will stand his watch forever, where the light never fails
      and no one is forgotten.
      
      The sea may claim many things, but it will not claim duty itself.

  - id: "lighthouse_abandoned"
    type: "narrative"
    name: "The Light Goes Out"
    requirements: ["flag:chose_freedom"]
    ends_game: true
    content: |
      The great lens dims as you turn the valve, its brilliant beacon fading to
      darkness for the first time in thirty years. Outside, the storm rages on,
      but you feel a strange peace settling over you like morning mist.
      
      "Thomas." Eleanor's voice is clear now, no longer memory but presence.
      "You kept the light burning longer than anyone had a right to ask."
      
      "Papa!" James calls from somewhere beyond the storm. "The boats know their
      way home now. You taught them. You showed them how to find the safe harbor."
      
      When morning comes, they'll find the lighthouse dark and Thomas Wickham gone.
      Ships will struggle in future storms, and some will not make it home. But
      some burdens are too heavy for one person to bear forever.
      
      In the end, the sea claims everything - but perhaps, sometimes, it also
      offers mercy.
      
      The light has gone out, but Thomas Wickham is finally at peace.

start:
  text: |
    The October storm builds like a living thing beyond the lighthouse walls.
    Thirty years you've stood watch at Blackrock Light, thirty years of storms
    and calms, of ships saved and ships lost. Tonight should be your last watch,
    your replacement arriving with the morning tide.
    
    But the storm has other plans.
    
    The barometer reads dangerously low, and through the salt-streaked windows
    you can see lights on the horizon - ships fighting their way through the gale.
    Your resignation letter sits on the desk, signed but somehow feeling
    unfinished.
    
    The light must not fail. It never has, not in thirty years.
    But tonight, for the first time, you wonder: what if it did?
  location: "lighthouse_base"
  first_flow: "final_watch"
  sets:
    - "knows:storm_severity"