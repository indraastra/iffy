title: "Friday Night Rain"
author: "Iffy Collective"
blurb: "The space between words grows heavier with each passing Friday."
version: "3.0"
context: "Another Friday evening ritual. But tonight, the silence tastes different."

ui:
  loadingMessage: "Listening..."

narrative:
  voice: "Intimate distance, present tense, like watching through rain"
  setting: "Corner café, closing time, city lights bleeding through wet windows"
  tone: "Quiet longing, things left unsaid, the weight of almosts"
  themes:
    [
      "unspoken truths",
      "friendship's fragile edge",
      "the courage to break silence",
      "urban solitude together"
    ]

# Predefined flags for story state
flags:
  # Core story events
  alex_confessed: false
  player_reciprocated: false
  alex_preparing_to_leave: false
  memories_shared: false
  
  # Observable states
  coffee_cold: true  # Starts cold
  barista_asked_about_coffee: false
  
  # Behavior patterns (LLM tracks these)
  behavior_patterns:
    player_supportive:
      description: "Player shows kindness, understanding, patience"
      examples:
        - "asks about Alex's feelings"
        - "offers physical comfort"
        - "shares positive memories"
        - "gives Alex time to speak"
    player_dismissive:
      description: "Player avoids emotional connection"
      examples:
        - "changes subject when Alex opens up"
        - "rushes conversation"
        - "shows impatience"
        - "focuses on leaving"
    alex_gaining_confidence:
      description: "Alex feels safer to share"
      triggers:
        - "player_supportive is true"
        - "memories_shared is true"
    alex_withdrawing:
      description: "Alex retreats emotionally"
      triggers:
        - "player_dismissive is true"
        - "conversation feels unsafe"

world:
  characters:
    alex:
      name: "Alex"
      sketch: "Your Friday companion who knows every barista's name and argues passionately about obscure
        films. Tonight they're stirring cold coffee like it holds answers, their usual quick wit
        replaced by something heavy behind careful eyes."
      arc: |
        Alex harbors romantic feelings but stands at an emotional crossroads. 
        Their behavior depends on flag states:
        
        IF alex_gaining_confidence: Opens up about feelings, tests waters with memories
        IF alex_withdrawing: Makes excuses, checks time, prepares to leave
        IF memories_shared AND player_supportive: Finds courage to confess
      voice: "Usually quick with film references and gentle teasing, but tonight speaks in careful words
        hiding deeper currents"

  locations:
    grounded_cafe:
      name: "Grounded Café"
      sketch: "Last light of day filtered through rain-streaked glass. Empty tables like islands in amber
        light. The barista's movements echo in the quiet - this liminal hour between day and night,
        between friends and something else entirely"
      atmosphere: [ "intimate emptiness", "closing time melancholy", "rain-washed" ]
      details:
      - "Coffee gone cold, untouched - a prop for nervous hands"
      - "Phone face-down, messages accumulating like guilt"
      - "Jazz so soft it might be memory"
      - "The wobbly table that's become your tradition"

scenes:
  opening:
    process_sketch: false
    location: "grounded_cafe"
    initial_flags:
      coffee_cold: true
      alex_stirring_count: 17  # Specific detail for narrative
    sketch: |
      Friday evening settles around your corner table like a familiar weight. The 
      rain outside turns café windows into moving watercolors of city lights. 
      Alex sits across from you, something unspoken weighing in the space between.

      These Friday evenings used to be easier. Now each word feels weighted,
      each pause examined. Something shifted weeks ago - a held gaze that 
      lasted too long, a goodbye hug that almost wasn't.

      The barista's voice cuts gentle through the quiet. "Should I warm that up?"

      [Alex](character:alex) doesn't hear, or pretends not to. Their reflection in the window 
      watches the rain while the real Alex stirs patterns in *cold coffee*.

      You've counted seventeen stirs. The barista waits, cloth in hand, 
      her glance asking you to translate this silence.
    
    # Flag triggers for this scene
    flag_triggers:
      - pattern: "player responds to barista about coffee"
        set: "barista_asked_about_coffee"
      - pattern: "player mentions shared memories or past experiences"
        set: "memories_shared"
      - pattern: "alex mentions leaving, checks time, or makes excuses"
        set: "alex_preparing_to_leave"
      - pattern: "alex reveals romantic feelings"
        set: "alex_confessed"
      - pattern: "player responds positively to confession"
        set: "player_reciprocated"
        requires: "alex_confessed"

endings:
  # Can only end if we've left the cafe OR Alex is leaving
  when: "player leaves the cafe"
  requires:
    any_of:
      - "location != grounded_cafe"
      - "alex_preparing_to_leave == true"

  variations:
  - id: "connection"
    when: "alex confesses and player reciprocates outside cafe"
    requires:
      all_of:
        - "alex_confessed == true"
        - "player_reciprocated == true"
        - "location != grounded_cafe"
    sketch: |
      "I've been trying to find the right words for weeks." [Alex](character:alex) finally 
      meets your eyes. "But maybe there aren't any right ones. Just true ones."

      The space between you dissolves. Rain stops. Something beautiful begins.

  - id: "friendship"
    when: "alex confesses but player wants friendship outside cafe"
    requires:
      all_of:
        - "alex_confessed == true"
        - "player_reciprocated == false"
        - "location != grounded_cafe"
    sketch: |
      [Alex](character:alex) nods slowly, understanding in their eyes. "I needed to say it. 
      I'm glad I did." A gentle smile. "Friends?"

      Sometimes honesty is its own gift, even when the answer isn't what we hoped.

  - id: "missed_chance"
    when: "alex decides to leave without confessing"
    requires:
      all_of:
        - "alex_preparing_to_leave == true"
        - "alex_confessed == false"
    sketch: |
      [Alex](character:alex) checks the time - that universal gesture of escape. 
      "I should go. Early morning."

      [!warning] Another Friday dissolved into careful nothing. The words remain unspoken.

guidance: |
  CRITICAL: Track flags based on narrative events. Set flags when their patterns occur.
  
  FLAG MANAGEMENT:
  - Set behavior flags (player_supportive/dismissive) based on accumulated actions
  - Set event flags (alex_confessed, memories_shared) when those events occur
  - Check alex's emotional state flags to guide their responses
  
  PACING: 
  - Use alex_gaining_confidence to have Alex open up gradually
  - Use alex_withdrawing to show Alex retreating
  - Only allow confession if sufficient emotional safety established
  
  NARRATIVE APPROACH:
  - Write with restraint - what's unsaid matters more than what's spoken
  - Focus on gestures, glances, the physical language of concealed emotion
  - Let silence have weight and meaning

  MANAGING PRONOUNS:
  - Begin with they/them or simply "Alex"
  - Follow the player's lead naturally - if they say "she", "him", "their", etc., adopt it
  - Store this in memory once established and use consistently

  Remember: This is about the space between friends where something else wants to exist.